<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
body { font-family: Poppins; margin:0; padding:0; background: #e3f2fd; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding-top:40px; }
.container { width:480px; background:rgba(255,255,255,0.85); padding:25px; border-radius:18px; box-shadow:0 4px 18px rgba(0,80,180,0.18); }
h1,h2 { text-align:center; color:#1565c0; margin-bottom:18px; font-weight:600; }
input { width:100%; padding:12px; margin:8px 0; border-radius:10px; border:1px solid #90caf9; }
button { width:100%; padding:12px; border:none; border-radius:12px; background:linear-gradient(to right,#42a5f5,#1e88e5); color:white; cursor:pointer; margin-top:10px; font-weight:600; }
button:hover { background:linear-gradient(to right,#64b5f6,#2196f3); transform:translateY(-2px); }
.link-btn { background:transparent; color:#1565c0; box-shadow:none; margin-top:5px; }
.link-btn:hover { color:#0d47a1; }
.hidden { display:none; }
table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 1px 6px rgba(0,0,0,0.1); }
th { background:#90caf9; padding:10px; color:#0d47a1; }
td { padding:10px; border-bottom:1px solid #e3f2fd; }
.status-on { color:#2e7d32; font-weight:bold; }
.status-off { color:#c62828; font-weight:bold; }
.logout-btn { padding:10px; background:#e53935; color:white; border:none; border-radius:10px; cursor:pointer; font-weight:600; margin-bottom:15px; }
.logout-btn:hover { background:#c62828; }
</style>
</head>
<body>

<div class="container" id="authBox">

  <!-- LOGIN -->
  <div id="loginScreen">
    <h1>Admin Login</h1>
    <input type="email" id="logEmail" placeholder="Email admin..." />
    <input type="password" id="logPass" placeholder="Password..." />
    <button onclick="adminLogin()">Login</button>
    <button class="link-btn" onclick="showRegister()">Belum punya akun? Register</button>
    <p id="loginResult"></p>
  </div>

  <!-- REGISTER -->
  <div id="registerScreen" class="hidden">
    <h2>Register Admin</h2>
    <input type="email" id="regEmail" placeholder="Email baru..." />
    <input type="password" id="regPass" placeholder="Password baru..." />
    <button onclick="adminRegister()">Register</button>
    <button class="link-btn" onclick="showLogin()">Kembali ke Login</button>
    <p id="regResult"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden">
    <h1>Dashboard Admin</h1>
    <button class="logout-btn" onclick="logout()">Logout</button>

    <h3>List API Keys</h3>
    <table id="apiTable">
      <tr><th>API Key</th><th>Status</th></tr>
    </table>

    <h3>List Users</h3>
    <table id="userTable">
      <tr><th>Nama</th><th>Email</th></tr>
    </table>
  </div>
</div>

<script>
const loginScreen = document.getElementById("loginScreen");
const registerScreen = document.getElementById("registerScreen");
const dashboard = document.getElementById("dashboard");
const loginResult = document.getElementById("loginResult");
const regResult = document.getElementById("regResult");
const apiTable = document.getElementById("apiTable");
const userTable = document.getElementById("userTable");

function showRegister(){ loginScreen.classList.add("hidden"); registerScreen.classList.remove("hidden"); }
function showLogin(){ registerScreen.classList.add("hidden"); loginScreen.classList.remove("hidden"); }

async function adminRegister(){
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPass").value;
  const res = await fetch("/admin/register",{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({email,password})});
  const data = await res.json();
  regResult.textContent = data.message;
  if(data.success) showLogin();
}

async function adminLogin(){
  const email = document.getElementById("logEmail").value;
  const password = document.getElementById("logPass").value;
  const res = await fetch("/admin/login",{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({email,password})});
  const data = await res.json();
  if(data.success && data.token){
    localStorage.setItem("token", data.token);
    loginScreen.classList.add("hidden");
    registerScreen.classList.add("hidden");
    dashboard.classList.remove("hidden");
    loadDashboard();
  } else { loginResult.textContent = data.message; }
}

async function loadDashboard(){
  const token = localStorage.getItem("token");
  if(!token) return;
  const res = await fetch("/admin/data",{ headers: { "Authorization": "Bearer " + token }});
  const payload = await res.json();
  if(!payload.success) return;
  const { apiKeys, users } = payload.data;

  apiTable.innerHTML = "<tr><th>API Key</th><th>Status</th></tr>";
  apiKeys.forEach(k=>{ apiTable.innerHTML += `<tr><td>${k.api_key}</td><td class="status-${k.status.toLowerCase()}">${k.status}</td></tr>`; });

  userTable.innerHTML = "<tr><th>Nama</th><th>Email</th></tr>";
  users.forEach(u=>{ userTable.innerHTML += `<tr><td>${u.first_name} ${u.last_name}</td><td>${u.email_address}</td></tr>`; });
}

function logout(){
  localStorage.removeItem("token");
  dashboard.classList.add("hidden");
  loginScreen.classList.remove("hidden");
}

if(localStorage.getItem("token")){ loginScreen.classList.add("hidden"); registerScreen.classList.add("hidden"); dashboard.classList.remove("hidden"); loadDashboard(); }
</script>

</body>
</html>
